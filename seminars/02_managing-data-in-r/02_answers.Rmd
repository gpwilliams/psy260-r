---
title: "PSY260 - Research Methods and Analysis"
subtitle: "R Workshop 2 - Managing and cleaning data in R Answers"
output: 
  html_document:
    css: "../../style.css"
    toc: true
    toc_float: true
    theme: united
    highlight: tango
author: "Dr Glenn Williams"
date: "2021-10-25 (Updated `r Sys.Date()`)"
---

Here, we'll get used to performing some basic data manipulation exercises in R. This set of questions introduces some more advanced functions for working with data. These exercises are more introductory while the questions are intended to be more difficult to help test your knowledge.

# Exercises

Please run the following code chunk before getting started. This will load the 2 crucial packages for this workshop and the raw data we will use to entrench the concepts taught in the lecture.

```{r setup, message = FALSE}
# load packages
library(tidyverse)
library(here)

# load data
raw_data <- read_csv(here("data", "seminar_two_data.csv"))
```

## Exercise 1

Make a code chunk. Print out the beginning of the data set either by just typing its name or using `glimpse(raw_data)`. Which columns can you identify as being initially problematic? Are there any?

```{r exercise-1-answer}
glimpse(raw_data)
```
*Response seems problematic in that it has multiple codes for the same variable. The same happens with CAFFEINE for the case of no/No, and potentially other values.*

## Exercise 2

Make a code chunk. Check the unique values for each variable in your data set. Are there any issues with the data set? If so, make a note of them.

```{r exercise-2-answer}
unique(raw_data$subject)
unique(raw_data$age)
unique(raw_data$CAFFEINE)
unique(raw_data$response)
unique(raw_data$DV)
```

```{r exercise-2-advanced-answer}
map(raw_data, unique)
```

## Exercise 3

Make a code chunk. Remove the age data from the data set. Save this new data set as "anonymised_data" within R. 

```{r exercise-3-answer}
anonymised_data <- select(raw_data, -age)
anonymised_data
```

## Exercise 4

Make a code chunk. Using your data from Exercise 3, clean up any issues you might have with the caffeine variable. Remember, you can use `mutate()` and `case_when()` together to solve this.

**Assign this to a new object called cleaned_data_one**

```{r exercise-4-answer}
cleaned_data_one <- anonymised_data %>% 
  mutate(
    CAFFEINE = case_when(
      CAFFEINE %in% c("no", "No") ~ "no",
      CAFFEINE %in% c("yes", "Yes", "Y") ~ "yes",
      TRUE ~ CAFFEINE
    )
  )

cleaned_data_one
```

If you're unsure how these functions work, type `?mutate` and then `?case_when` in the console. The Help pane outlines how these functions work, and gives examples of working code.

If you're still stuck, refer back to Lecture 2 part 3.

## Exercise 5

Make a code chunk. Using your data from Exercise 4, clean up any issues you might have with the response variable using the same methods outlined in Exercise 3.

**Assign this to a new object called cleaned_data_two**

```{r exercise-5-answer}
cleaned_data_two <- cleaned_data_one %>% 
  mutate(
    response = case_when(
      response %in% c("ND", "non-dominant") ~ "non_dominant",
      response %in% c("D", "Dominant", "DOM") ~ "dominant",
      TRUE ~ response
    )
  )

cleaned_data_two
```

## Exercise 6

Make a code chunk. Add the age data from your initial data (raw_data) back in to the cleaned data (cleaned_data_two).

```{r exercise-6-answer}
cleaned_data_two$age <- raw_data$age
cleaned_data_two
```

## Exercise 7

Make a code chunk. Filter out any observations on the dependent variable which are NAs. Remember to use `is.na()`. Assign this new data to a object called "cleaned_data_three".

```{r exercise-7-answer}
cleaned_data_three <- cleaned_data_two %>% 
  filter(!is.na(DV))

cleaned_data_three
```

# Questions

These remaining questions are designed to push you a little further to improve your knowledge. Please complete these in your own time.

Please run the following R code chunk by pressing the green play button. This will load the data up from the "data" folder and print it out in your console.

```{r load-q-data}
qdata <- read_csv(here("data", "seminar_two_question_data.csv"))
qdata # inspect it
```

You have just loaded in some data to the object `qdata`. This contains questionnaire data in a **long format** with the following variables:

- ID: the participant ID number.

- LANGUAGE: the natural language spoken by the participant classified, hopefully, into English and Other.

- progress: Whether or not participants completed the questionnaire.

- gender: the self-identified gender of the participant.

- age: the age of the participant (in years).

- tester: initials of the person who obtained the data.

- funRec: whether participants found the questionnaire fun, and if they'd recommend it to others.

- completition_time: the times that participants started and finished the questionnaire.

- computer_language: which computer languages the participants are proficient in (e.g. C++, JavaScript, R).

We will work on this data to advance our knowledge of managing data in R.

## Question 1

The ID column should be numeric. They do not need to be in any particular order or pattern. Can you make the IDs all numeric?

```{r question-1}
unique_ids <- unique(qdata$ID)
qdata$ID <- match(qdata$ID, unique_ids)

# inspect data
qdata$ID
```

## Question 2

The language column should have only two values (excluding NAs): English and Other. Can you change these to be a consistent code? Remember codes are case sensitive.

```{r question-2}
qdata$LANGUAGE <- tolower(qdata$LANGUAGE)

# inspect data
unique(qdata$LANGUAGE)
```

## Question 3

Are there any problems with the gender, age, and tester columns? Explain your thinking. You can use code to demonstrate your work.

```{r answer-3}
unique(qdata$gender)
unique(qdata$age)
unique(qdata$tester)
```

There are no obvious problems with these variables.

## Question 4

We have two columkns, funRec and completion_time, which actually store two variables each within a cell. 

funRec stores a number from 1-7 for how fun people found the task and whether or not they would recommend the study to a friend (yes/no). These are separated by a minus (-) sign.

completion_time stores date times in the format of YYYY-MM-DD HH:MM:SS for when participants started and finished the study, separated by an underscore (_) sign.

Learn about the function, `separate()` from tidyr in the tidyverse. This will help to create two columns for each of these columns to keep our data separate.

### Question 4a

Separate the data in funRec into two columns, fun and recommend.

```{r question-4a}
qdata <- separate(
  qdata,
  col = funRec,
  into = c("fun", "recommend")
)

# inspect data
qdata
```

### Question 4b

Separate the data from completion_time into two columns, start and end. *Hint*: For this one, you'll need to be specific about what separates the two forms of data in the column.

```{r question-4b}
qdata <- separate(
  qdata,
  col = completion_time,
  into = c("start", "end"),
  sep = "_"
)

# inspect data
qdata
```

## Question 5

We will create a new variable, making a median split of ages (i.e. above or below the sample median).

### Question 5a

Create a variable called `age_median` based simply on the median of the ages in `qdata`.

```{r answer-5a}
age_median <- median(qdata$age)

# inspect data
age_median
```

### Question 5b

Create a column in qdata called age_median, which divides each person in the data set as being in the "old" or "young" groups based on whether or not their age is greater than or equal to the median, or below the median respectively.

This will require some logic.

```{r answer-5b}
qdata$age_median <- case_when(
  qdata$age >= age_median ~ "old",
  qdata$age < age_median ~ "young"
)

# inspect data
qdata$age_median
```

## Question 6

We don't care about the testers for now. Remove this column from the data set.

```{r answer-6}
qdata <- select(qdata, -tester)

# inspect data
qdata
```

## Question 7

Filter out anyone from the data set who knows the computer language FORTRAN (nerds). You might need to return to the logical operations in lecture 1 to do this properly.

```{r answer-7}
qdata <- filter(qdata, computer_language != "FORTRAN")

# inspect data
qdata
```

## Question 8

Add the below data to your data set. You may will need to execute this code chunk before you can do this.

```{r question-8-data}
final_row <- tibble(
  ID = 100,
  progress = "finish",
  gender = "female",
  age = 30,
  fun = 7,
  recommend = "yes",
  start = "2018-03-22 23:05:11",
  end = "2018-03-22 23:25:01",
  age_median = NA
)
```

```{r answer-8-error, eval = FALSE}
qdata <- bind_rows(qdata, final_row)
```

If you get an error, it's likely because your data types are incompatible. 

Look at the column names in the error code. What's going on? Ensure that the data in both data sets for this column matches, using the mutate function.

```{r answer-8-fixed}
# fix the coding for the fun data column in qdata
qdata$fun <- as.numeric(qdata$fun)

# bind rows together
qdata <- bind_rows(qdata, final_row)

# inspect data
qdata
```

## Question 9

Add a column of random numbers to `qdata` just because you can. Use the `rnorm()` function to create a column called "nonsense_scores" with a mean of 100, standard deviation of 15, and n of the same number as the observations we have in `qdata`.

```{r answer-9}
qdata$nonsense_scores <- rnorm(n = nrow(qdata), mean = 100, sd = 15)

# inspect data
qdata
```

**Bonus points**: Are there any psychometric scores that people put too much weight into that you can think of with a mean of 100 and a standard deviation of 15? IQ!

## Question 10

Create a folder called "outputs" at the same level of your R Project directory. Save qdata there as "my_tidied_data.csv".

```{r answer-10, eval = FALSE}
write_csv(qdata, here("outputs", "my_tidied_data.csv"))
```
