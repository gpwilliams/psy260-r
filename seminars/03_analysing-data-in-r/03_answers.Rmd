---
title: "PSY260 - Research Methods and Analysis"
subtitle: "R Workshop 3 - Analysing Data in R"
output: 
  html_document:
    css: "../../style.css"
    toc: true
    toc_float: true
    theme: united
    highlight: tango
author: "Dr Glenn Williams"
date: "2020-10-25 (Updated `r Sys.Date()`)"
---

Here, we'll get used to performing analyses and summarising data in R. This set of questions introduces some more advanced functions for analysing data. These exercises are more introductory while the questions are intended to be more difficult to help test your knowledge.

# Exercises

Please run the following code chunk before getting started. This will load the 2 crucial packages for this workshop and the raw data we will use to entrench the concepts taught in the lecture.

```{r setup, message = FALSE}
# load packages
library(tidyverse)
library(here)

# load data
raw_data <- read_csv(here("data", "seminar_three_data.csv"))
```

## Exercise 1

How many participants do we have in the experiment? How many items? Write some R code to check this.

*Hint*: `length()` and `unique()` are useful here.

```{r exercise-1-answer}
raw_data %>% 
  summarise(
    n_subj = length(unique(subj_id)),
    n_items = length(unique(item_id))
  )
```

## Exercise 2

The labels for the conditions in column A are not very informative. Please give these suitable names in the data set.

There are (at least) two methods to achieve this. Create a column (or overwrite the existing one) using:

1. `case_when()` as in previous lectures/seminars.

2. `factor()` within `mutate()`.

*Please see the lecture on manipulating data if you get stuck.*

```{r exercise-2-answer}
# option 1: case_when in mutate
raw_data <- raw_data %>% 
  mutate(
    A = case_when(
      A == "A1" ~ "congruent",
      A == "A2" ~ "incongruent"
    )
  )
```

```{r exercise-2-alternative-answer, eval = FALSE}
# option 1: change to a factor
raw_data$A <- factor(
  raw_data$A, 
  levels = c("A1", "A2"), 
  labels = c("congruent", "incongruent")
)
```

## Exercise 3

### Part A

Create a summary of the reaction times per condition for each participant. Choose a way to summarise this based on central tendency (e.g. mean, median, mode).

Typically we use this data for inferential tests and plots.

Assign this data to the object `data_summary`.

```{r exercise-3-answer}
data_summary <- raw_data %>% 
  group_by(subj_id, A) %>% 
  summarise(mean_y = mean(Y))
```

### Part B

Write a sentence to justify your choice of measure for central tendency and dispersion in your summary statistics.

*I chose the mean as it's the most common summary, but I really should have a look at how many extreme scores I have before I do this. I also picked the mean because I simulated the data to be drawn from a normal distribution..."*

## Exercise 4

Create a plot to display the average reaction time per condition in the experiment using the data from `data_summary` in Exercise 3. Justify your choice of plot.

Assign this plot to a variable called `my_plot`.

```{r exercise-4-answer}
my_plot <- ggplot(
  data = data_summary, 
  mapping = aes(x = A, y = mean_y)
) +
  geom_boxplot()

my_plot
```

*I used the boxplot because it gives a robust measure of the average and highlights outliers.*

## Exercise 5

Update your code used to plot `my_plot` in Exercise 4 to have different fills for each condition and to have proper labels on the X and Y axis titles.

```{r exercise-5-answer}
my_plot <- ggplot(
  data = data_summary, 
  mapping = aes(x = A, y = mean_y, fill = A)
) +
  geom_boxplot() +
  labs(x = "Condition", y = "Mean Reaction Time")

my_plot
```

## Exercise 6

In this experiment we want to exclude participants with average scores one standard deviation above or below the mean.

### Part A

Find out the overall mean and standard deviation from the reaction times saved in `data_summary`. Assign this summary to the variable `data_cutoffs`.

*Hint*: If you use `summarise()` (which you may not need to), be sure to use ungroup in your chain of functions first, e.g.: `data_summary %>% ungroup() %>% **your code goes here**`.

```{r exercise-6a-answer}
data_cutoffs <- data_summary %>% 
  ungroup() %>% 
  summarise(
    mean = mean(mean_y),
    sd = sd(mean_y)
  )
data_cutoffs
```

### Part B

Keep only participants with scores greater than 1 standard deviation below the mean **and** less than 1 standard deviation above the mean.

Assign this data to the object `data_summary_filtered`.

*Hint*: You will need to use your answer from Part A to achieve this.

```{r exercise-6b-answer}
data_summary_filtered <- data_summary %>% 
  filter(
    mean_y > (data_cutoffs$mean - data_cutoffs$sd) &
      mean_y < (data_cutoffs$mean + data_cutoffs$sd)
  )
# students may choose to input the numbers directly in the
# filter evluation, but this is bad practice (these can change).

# confirm filtering
nrow(data_summary)
nrow(data_summary_filtered)
```

### Part C

Create a final plot as in Exercise 5, now with your data from `data_summary_filtered`.

```{r exercise-6c-1-answer}
ggplot(
  data = data_summary_filtered, 
  mapping = aes(x = A, y = mean_y, fill = A)
) +
  geom_boxplot() +
  labs(x = "Condition", y = "Mean Reaction Time")
```

```{r exercise-6c-2-answer}
# if they're really good they'll do this 
# (and probably don't need a beginner's R course)
my_plot %+% data_summary_filtered
```

# Questions

These remaining questions are designed to push you a little further to improve your knowledge. Please complete these in your own time.

Please run the following R code chunk by pressing the green play button. This will load the data up from the "data" folder and print it out in your console.

```{r question-data, message = FALSE, warning = FALSE}
qdata <- read_csv(here("data", "cleanish_data.csv"))
qdata # inspect it
```

This data set is that from lecture 2b - Data Checking in R. The columns have the following interpretation:

- **X1** = Row number for the data.

- **subj_id** = Subject/participant ID for the person who gave the data to us.

- **list_id** = list ID for how items were randomised.

- **item_id** = Item ID.

- **variable A** = Implied sentence location (upwards or downwards); e.g. "the bird flew in the sky." a1 is up, a2 is down.

- **variable B** = Location of target (up or down on the screen). b1 is up, b2 is down.

## Question 1

Remove any unnecessary columns from this data set.

```{r question-1-answer}
qdata <- qdata %>% select(-X1)
```

## Question 2

Give proper levels names to the levels A1 and A2 in column A and to B1 and B2 in column B.

```{r question-2-answer}
qdata <- qdata %>% 
  mutate(
    A = case_when(
      A == "a1" ~ "up",
      A == "a2" ~ "down"
    ),
    B = case_when(
      B == "b1" ~ "up",
      B == "b2" ~ "down"
    )
  )
```

## Question 3

Give proper (column) names to the variables A, B, and Y.

```{r answer-3-answer}
qdata <- qdata %>% 
  rename(
    sentence_location = A,
    target_location = B,
    reaction_time = Y
  )
```

## Question 4

Make a summary of the data creating averages of the reaction times for each level of each condition for every participant. Assign this to the object `summary_data`.

```{r answer-4-answer}
summary_data <- qdata %>% 
  group_by(subj_id, sentence_location, target_location) %>% 
  summarise(mean_rt = mean(reaction_time, na.rm = TRUE))
```

## Question 5

Remove participants 1 through to 10 from `summary_data`.

```{r answer-5-answer}
summary_data <- summary_data %>% 
  filter(subj_id > 10)
```

## Question 6

Make a boxplot of the data. Does there appear to be any reliable differences between conditions? Explain your logic.

```{r answer-6-answer}
ggplot(
  data = summary_data, 
  mapping = aes(
    x = sentence_location, 
    y = mean_rt, 
    fill = target_location
  )
) +
  geom_boxplot()
```

## Question 7 (Advanced, Bonus Material)

We can perform inferential statistics in R. 

I have simulated some data below for a 2 group experiment. The two groups are "control" and "treatment" which are assigned to the column "condition" while the outcome is in the column "outcome". (It doesn't matter what this column or study represents, data only have meaning we assign to it.)

```{r simulate-data-question-7}
n <- 40

q8dat <- tibble(
  condition = rep(c("control", "treatment"), times = n),
  outcome = c(
    rnorm(n, mean = 400, sd = 100),
    rnorm(n, mean = 500, sd = 150)
  )
)
```

We can analyse this data using a t-test as follows:

```{r t-test-question-7-answer}
t.test(outcome ~ condition, data = q8dat)
```
We get the above summary of the t-test. (Your exact values may vary due to simulating this data.)

We can see above that we can analyse data using a formula interface `outcome ~ treatment`. This means scores to the left of the `~` are predicted by the values assigned to the right side of the `~`; i.e. your condition dictates your score.

We can similarly perform an ANOVA using this method. This means we perform an ANOVA with two main effects (e.g. a two-way ANOVA) as follows:

```{r anova-example-1, eval = FALSE}
aov(outcome ~ FACTOR_A + FACTOR_B, data = YOUR_DATA)
```

Here, any terms added to the right of the `~` are evaluated as main effects if we make their effects additive. If instead we use a multiplication symbol, we get both main effects **and interactions**.

Perform an ANOVA for your data. To get your typical ANOVA table output, you must use `summary(aov(...))` or assign your ANOVA model to an object and call `summary()` on that object.

```{r anova-example-1-answer}
aov_summary <- aov(
  mean_rt ~ sentence_location * target_location, 
  data = summary_data
)
summary(aov_summary)
```

**There are no main effects of interactions present (all *p*s > .186).**

This answer may appear correct, but with repeated measures we need to tell R to adjust the errors (i.e. to conduct a within- rather than a between-subjects ANOVA) for any terms we want to estimate within each participant. Do this as follows:

```{r anova-example-2, eval = FALSE}
aov(
  outcome ~ FACTOR_A * FACTOR_B + 
    Error(SUBJECT_ID_COLUMN/(FACTOR_A * FACTOR_B)), 
  data = YOUR_DATA
)
```

Adjust your code to incorporate this. Do your estimates change? Can you explain why?

```{r anova-example-2-answer}
aov_summary <- aov(
  mean_rt ~ sentence_location * target_location + 
    Error(subj_id/(sentence_location * target_location)), 
  data = summary_data
)
summary(aov_summary)
```

*The results are still non-significant. The F-values are now smaller, likely due to partialling-out any random variance that is more attributable to participant level variance rather than consistent effects.*
